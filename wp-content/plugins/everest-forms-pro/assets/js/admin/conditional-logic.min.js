!function(y){var h={init:function(){y(document).ready(h.ready),h.bindUIActions(),y('.everest-forms-field-option-row-conditional_logic_status input[type="checkbox"]').each(function(e,i){if(y(this).is(":checked")){var n=y(this).closest(".everest-forms-field-option-row-conditional_logic_status").siblings(".evf-field-conditional-container");n.fadeIn("slow"),n.find(".evf-field-conditional-field-select").trigger("change"),n.find(".evf-field-conditional-condition").trigger("change")}}),y(".evf_conditional_logic_container").find('input[type="checkbox"]').each(function(e,i){if(y(this).is(":checked")){var n=y(this).closest(".evf_conditional_logic_container").siblings(".evf-field-conditional-container");n.fadeIn("slow"),n.find(".evf-field-conditional-field-select").trigger("change"),n.find(".evf-field-conditional-condition").trigger("change")}})},bindUIActions:function(){var i,n;y(document).on("change",".everest-forms-field-option-group-inner .everest-forms-field-option-row-conditional_logic_status input",function(e){h.enableConditionLogic(this,e)}),y(document).on("change","#everest-forms-panel-field-settingsemail-evf_send_confirmation_email",function(e){h.showConditionalOnEmail(this,e)}),y(document).on("change",".everest-forms-panel-field input",function(e){h.enableConditionLogic(this,e)}),y(document).on("click",".evf-field-conditional-field-select",function(e){i=this.value,n=y(this).siblings().not(".evf-field-conditional-condition").val()}).on("change",".evf-field-conditional-field-select",function(e){h.inputType(this,e,i,n)}),y(document).on("keyup",".everest-forms-field-option-row-label",function(e){h.LiveField(this,e)}),y(document).on("click",".conditonal-rule-add",function(e){h.ruleAdd(this,e)}),y(document).on("click",".conditonal-rule-remove",function(e){h.ruleRemove(this,e)}),y(document).on("click",".conditonal-group-add",function(e){h.GroupAdd(this,e)}),y(document).on("change",".evf-field-conditional-condition",function(e){h.conditionCheck(this,e)})},showConditionalOnEmail:function(e,i){jQuery("#everest-forms-panel-field-settingsemail-conditional_logic_status-wrap").show()},conditionCheck:function(e,i){var n=y(e);"empty"===n.val()||"not_empty"===n.val()?(n.siblings(".evf-field-conditional-input").val(""),n.siblings(".evf-field-conditional-input").prop("disabled",!0)):n.siblings(".evf-field-conditional-input").prop("disabled",!1)},enableConditionLogic:function(e,i){(i=y(e)).is(":checked")?(i.closest(".evf_conditional_logic_container").siblings(".evf-field-conditional-container").fadeIn("slow"),i.closest(".evf_conditional_logic_container").siblings(".evf-field-conditional-container").find(".evf-field-conditional-field-select").trigger("change")):i.closest(".evf_conditional_logic_container").siblings(".evf-field-conditional-container").fadeOut("slow")},LiveField:function(e,i){var n=y(".everest-forms-field-option:visible").data("field-id");y(".evf-field-conditional-field-select").find("[data-field_id="+n+"]").text(y(e).children("input").val())},renderSelectionPayment:function(e,i,n){var t=e.closest(".evf-field-conditional-container").attr("data-connection_id"),o=void 0!==n&&"undefined"!=typeof n[group]&&"undefined"!=typeof n[group][key]&&"undefined"!=typeof n[group][key].value?n[group][key].value:"",a={completed:"Completed",failed:"Failed"},d="";for(index in a){var l="";o===index&&(l=' selected="selected"'),d+='<option value="'+index+'"'+l+">"+a[index]+"</option>"}e.parent().find(".evf-field-conditional-input").remove(),e.parent().append('<select class="evf-field-conditional-input" name="'+i+"["+t+"][conditionals]["+group+"]["+key+'][value]" ><option>---Select Option---</option>'+d+"</select>")},inputType:function(e,i,n,t){i.preventDefault();var a=y(e),o=a.attr("data-panel-source"),d=a.find(":selected").data("field_id"),l=a.closest(".evf-field-conditional-wrapper").data("field-id");if(selected_f_id="field"===o?l.replace("-","_"):"",a.parent().parent().find("a").prop("disabled",!1).removeClass("everest-forms-disabled"),y(".conditonal-group-add").prop("disabled",!1).removeClass("everest-forms-disabled"),"undefined"!=typeof window["evf_field_integration_data_"+selected_f_id]&&"field"===o)var c=void 0!==(f=JSON.parse(window["evf_field_integration_data_"+selected_f_id]))?f.conditionals:"";else if("settings"===o||"payments"===o){var f,s=a.closest(".evf-field-conditional-container").attr("data-connection_id");c=void 0!==(f="undefined"!=typeof window["evf_"+o+"_"+a.attr("data-source")+"_conditional_data_"+s]?JSON.parse(window["evf_"+o+"_"+a.attr("data-source")+"_conditional_data_"+s]):"")?f.conditionals:""}var r=a.closest(".evf-field-conditional-wrapper").children("li"),p=[];if(r.each(function(e,i){var n=y(i).attr("data-key");p.push(n);var t=Math.max.apply(Math,p);a.closest(".evf-field-conditional-wrapper").attr("data-next-id",t+1)}),key=a.closest("li").data("key"),group=a.closest(".evf-field-conditional-wrapper").attr("data-group"),$container=y(".everest-forms-panel-sidebar .everest-forms-tab-content").find('.everest-forms-field-option[data-field-id="'+d+'"]').first(),options=$container.find(".everest-forms-field-option-group-inner .everest-forms-field-option-row-choices ul").find("input.label"),selected_option_type=a.find(":selected").data("field_type"),"field"===o)var v="form_fields["+l+"]";else if("payments"===o)v="payments["+a.closest(".evf-field-conditional-container").siblings(".evf_conditional_logic_container").find("input[type=checkbox]").attr("data-panel-source")+"]";else v="settings["+a.attr("data-source")+"]";switch(selected_option_type){default:a.parent().find(".evf-field-conditional-input").remove();var u=void 0!==c&&"undefined"!=typeof c[group]&&"undefined"!=typeof c[group][key]&&"undefined"!=typeof c[group][key].value?c[group][key].value:"";if((void 0!==c&&"undefined"!=typeof c[group]&&"undefined"!=typeof c[group][key]&&"undefined"!=typeof c[group][key].field?c[group][key].field:"")!=a.find(":selected").attr("data-field_id")&&(u=""),"field"===o)a.parent().append('<input class="evf-field-conditional-input" name="'+v+"[conditionals]["+group+"]["+key+'][value]" type="text" value="'+u+'" />');else if("settings"===o||"payments"===o){var g=a.closest(".evf-field-conditional-container").attr("data-connection_id");a.parent().append('<input class="evf-field-conditional-input" name="'+v+"["+g+"][conditionals]["+group+"]["+key+'][value]" type="text" value="'+u+'" />')}break;case"checkbox":case"radio":case"select":if(a.parent().find(".evf-field-conditional-input").remove(),"field"===o)a.parent().append('<select class="evf-field-conditional-input" name="'+v+"[conditionals]["+group+"]["+key+'][value]" ><option>---Select Option---</option></select>');else if("settings"===o||"payments"===o){g=a.closest(".evf-field-conditional-container").attr("data-connection_id");a.parent().append('<select class="evf-field-conditional-input" name="'+v+"["+g+"][conditionals]["+group+"]["+key+'][value]" ><option>---Select Option---</option></select>')}var m=void 0!==c&&"undefined"!=typeof c[group]&&"undefined"!=typeof c[group][key]&&"undefined"!=typeof c[group][key].value?c[group][key].value:"";y(options).each(function(e,i){var n=y(i).val(),t="";c&&n===m&&(t="selected"),a.parent().find(".evf-field-conditional-input").append('<option value="'+n+'" '+t+">"+n+"</option>")});break;case"payment":a.parent().siblings().prop("disabled",!0).addClass("everest-forms-disabled"),y(".conditonal-group-add").prop("disabled",!0).addClass("everest-forms-disabled"),1<a.closest(".evf-field-conditional-container").find(".evf-conditional-group").length?y.confirm({title:evf_conditional_rules.i18n_remove_rule,content:evf_conditional_rules.i18n_remove_rule_message,type:"red",closeIcon:!1,icon:"dashicons dashicons-warning",escapeKey:"cancel",backgroundDismiss:!1,buttons:{confirm:{text:"OK",btnClass:"btn-red",action:function(){a.closest(".evf-field-conditional-wrapper").siblings().not(".evf-field-logic").not(".everest-forms-disabled").not(".everest-forms-border-container-title").remove(),a.closest(".evf-conditional-group").siblings().remove(),a.closest(".evf-field-conditional-wrapper").append('<span class="conditional_or">OR</span>'),h.renderSelectionPayment(a,v,c)}},cancel:function(){a.val(n).change(),a.siblings().not(".evf-field-conditional-condition").val(t).change(),a.parent().siblings().prop("disabled",!1).removeClass("everest-forms-disabled"),y(".conditonal-group-add").prop("disabled",!1).removeClass("everest-forms-disabled")}}}):h.renderSelectionPayment(a,v,c);break;case"payment-multiple":case"payment-checkbox":if(a.parent().find(".evf-field-conditional-input").remove(),"field"===o)a.parent().append('<select class="evf-field-conditional-input" name="'+v+"[conditionals]["+group+"]["+key+'][value]" ><option>---Select Option---</option></select>');else if("settings"===o||"payments"===o){g=a.closest(".evf-field-conditional-container").attr("data-connection_id");a.parent().append('<select class="evf-field-conditional-input" name="'+v+"["+g+"][conditionals]["+group+"]["+key+'][value]" ><option>---Select Option---</option></select>')}m=void 0!==c&&"undefined"!=typeof c[group]&&"undefined"!=typeof c[group][key]&&"undefined"!=typeof c[group][key].value?c[group][key].value:"";y(options).each(function(e,i){var n=y(i).val(),t=y(i).attr("data-key"),o="";c&&t===m&&(o="selected"),a.parent().find(".evf-field-conditional-input").append('<option value="'+t+'" '+o+">"+n+"</option>")});break;case"country":if(a.parent().find(".evf-field-conditional-input").remove(),"field"===o)a.parent().append('<select class="evf-field-conditional-input" name="'+v+"[conditionals]["+group+"]["+key+'][value]"></select>');else if("settings"===o||"payments"===o){g=a.closest(".evf-field-conditional-container").attr("data-connection_id");a.parent().append('<select class="evf-field-conditional-input" name="'+v+"["+g+"][conditionals]["+group+"]["+key+'][value]"></select>')}options=$container.find(".everest-forms-field-option-group-advanced .everest-forms-field-option-row-default select").children();var _=void 0!==c&&"undefined"!=typeof c[group]&&"undefined"!=typeof c[group][key]&&"undefined"!=typeof c[group][key].value?c[group][key].value:"";y(options).each(function(e,i){var n=y(i).val(),t="";c&&n===_&&(t="selected"),a.parent().find(".evf-field-conditional-input").append('<option value="'+n+'" '+t+">"+y(i).text()+"</option>")})}},ruleAdd:function(e,i){i.preventDefault();var n=y(e),t=n.siblings(".evf-form-group").children(".evf-field-conditional-field-select").attr("data-panel-source"),o=n.closest(".evf-field-conditional-container").attr("data-connection_id"),a=n.closest("li").clone();a.find("input").val(""),a.find("option:selected").prop("selected",!1);var d=n.closest(".evf-field-conditional-wrapper"),l=d.data("field-id"),c=d.attr("data-next-id"),f=d.attr("data-group");if("field"===t)var s="form_fields["+l+"]";else if("payments"===t)s="payments["+n.closest(".evf-field-conditional-container").siblings(".evf_conditional_logic_container").find("input[type=checkbox]").attr("data-panel-source")+"][connection_1]";else s="settings["+n.closest(".evf-field-conditional-container").children(".evf-field-conditional-wrapper").first().find(".evf-field-conditional-field-select").attr("data-source")+"]["+o+"]";a.attr("data-key",c),a.find(".evf-field-conditional-field-select").attr("name",s+"[conditionals]["+f+"]["+c+"][field]"),a.find(".evf-field-conditional-condition").attr("name",s+"[conditionals]["+f+"]["+c+"][operator]"),a.find(".evf-field-conditional-input").attr("name",s+"[conditionals]["+f+"]["+c+"][input_choice]"),n.closest("li").after(a),c++,n.closest(".evf-field-conditional-wrapper").attr("data-next-id",c),y(a).children(".evf-form-group").children(".evf-field-conditional-field-select").trigger("change")},ruleRemove:function(e,i){i.preventDefault();var n=y(e),t=n.closest(".evf-field-conditional-wrapper").parent(".evf-field-conditional-container"),o=n.closest(".evf-field-conditional-wrapper");t.find("li").length<2?y.alert({title:!1,content:evf_data.i18n_row_locked_msg,icon:"dashicons dashicons-info",type:"blue",buttons:{ok:{text:evf_data.i18n_ok,btnClass:"btn-confirm",keys:["enter"]}}}):o.find("li").length<2?n.closest("ul").remove():n.closest("li").remove()},GroupAdd:function(e,i){i.preventDefault();var n=y(e),t=n.attr("data-panel-source"),o=n.closest(".evf-field-conditional-container").attr("data-connection_id"),a=n.siblings(".evf-field-conditional-wrapper").first(),d=a.clone(),l=a.data("field-id");if("field"===t)var c="form_fields["+l+"]";else if("payments"===t)c="payments["+n.closest(".evf-field-conditional-container").siblings(".evf_conditional_logic_container").find("input[type=checkbox]").attr("data-panel-source")+"][connection_1]";else c="settings["+n.closest(".evf-field-conditional-container").children(".evf-field-conditional-wrapper").first().find(".evf-field-conditional-field-select").attr("data-source")+"]["+o+"]";d.find(".evf-conditional-group").not(":first").remove(),d.find("input").val(""),d.find("option:selected").prop("selected",!1),d.attr("data-next-id",2);var f=d.attr("data-next-id"),s=n.siblings(".evf-field-conditional-wrapper").last().attr("data-group");d.attr("data-group",parseInt(s)+1);var r=d.data("group");d.find("li").attr("data-key",1),d.find(".evf-field-conditional-field-select").attr("name",c+"[conditionals]["+r+"]["+(f-1)+"][field]"),d.find(".evf-field-conditional-condition").attr("name",c+"[conditionals]["+r+"]["+(f-1)+"][operator]"),d.find(".evf-field-conditional-input").attr("name",c+"[conditionals]["+r+"]["+(f-1)+"][input_choice]");var p=d.insertBefore(n);p.find(".conditional_or").remove(),p.append('<span class="conditional_or">OR</span>'),y(p).children(".evf-conditional-group").children(".evf-form-group").children(".evf-field-conditional-field-select").trigger("change")}};h.init()}(jQuery);